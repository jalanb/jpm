#! /usr/bin/env python

import sys


from jpm.mpd import services  # pylint: disable-msg=no-name-in-module
from mpd.mpc import Mpc


def find_method(client, name):
    """Find a method with that name in the jpm module, or this script"""
    for item in [client, services]:
        if hasattr(item, name):
            return getattr(item, name)

    def not_found():
        raise ValueError('No such command: %r' % name)

    return not_found


def main(args):
    """Run the program"""
    client = Mpc()
    try:
        for arg in args:
            method = getattr(client, arg, None)
            if method:
                method()
            else:
                method = getattr(services, arg, None)
                if method:
                    method()
    except Exception, e:  # pylint: disable-msg=broad-except
        print >> sys.stderr, e
        return not os.EX_OK
    return os.EX_OK


if __name__ == '__main__':
    sys.exit(jpm.main(sys.argv[1:]))
