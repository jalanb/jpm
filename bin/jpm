#! /usr/bin/env python

import sys
import inspect


from jpm import jpmpd  # pylint: disable-msg=no-name-in-module
from jpm import jpm  # pylint: disable-msg=no-name-in-module


def find_method(name):
    """Find a method with that name in the jpm module, or this script"""
    for module in [jpm, jpmpd]:
        if hasattr(module, name):
            return getattr(module, name)

    def not_found():
        raise ValueError('No such command: %r' % name)

    return not_found


def main(args):
    """Run the program"""
    client = jpm.mpd_client()
    try:
        for arg in args:
            method = find_method(arg)
            method_args = inspect.getargspec(method).args
            if 'client' in method_args:
                method(client)
            else:
                method()
    except Exception, e:  # pylint: disable-msg=broad-except
        print >> sys.stderr, e
        return not os.EX_OK
    return os.EX_OK


if __name__ == '__main__':
    sys.exit(jpm.main(sys.argv[1:]))
